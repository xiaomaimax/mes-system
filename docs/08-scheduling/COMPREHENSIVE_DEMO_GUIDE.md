# 综合排程演示数据指南

**版本**: v1.0  
**创建时间**: 2025-12-25  
**目标**: 演示10种排程核心逻辑规则

---

## 📋 概述

本指南介绍如何使用综合演示数据脚本来模拟10种排程核心逻辑规则的所有场景。

### 演示目标

每种排程规则都有对应的计划单和配置，执行排程后可以看到该规则被应用的结果。

---

## 🚀 快速开始

### 步骤1: 运行初始化脚本

```bash
node scripts/init-comprehensive-scheduling-data.js
```

**输出示例**:
```
✅ 创建物料: 手机壳A (MAT-001)
✅ 创建物料: 手机壳B (MAT-002)
...
✅ 创建设备: 注塑机1号 (DEV-001)
...
✅ 创建模具: 模具A (MOLD-001)
...
✅ 创建计划单: PL-URGENT-001 - 紧急订单 - 演示交期优先
...
✨ 综合排程演示数据初始化完成！
```

### 步骤2: 执行排程

1. 打开浏览器访问 http://localhost:3000
2. 登录系统
3. 点击"辅助排程"
4. 点击"执行自动排产"按钮
5. 确认操作

### 步骤3: 查看排程结果

1. 点击"排程结果"标签页
2. 查看每个任务单的"排程原因"列
3. 观察10种规则的应用情况

---

## 📊 数据结构设计

### 物料配置 (11个)

| 物料代码 | 物料名称 | 用途 | 演示规则 |
|---------|---------|------|--------|
| MAT-001 | 手机壳A | 基础物料 | 2️⃣ 设备权重优先 |
| MAT-002 | 手机壳B | 基础物料 | 5️⃣ 模具-设备绑定 |
| MAT-003 | 充电器 | 基础物料 | 4️⃣ 模具-设备独占性 |
| MAT-004 | 电池盖板 | 基础物料 | 8️⃣ 计划单唯一性 |
| MAT-005 | 屏幕保护膜 | 基础物料 | - |
| MAT-006 | 手机壳C | 同模多物料 | 9️⃣ 同模多物料同步 |
| MAT-007 | 手机壳D | 同模多物料 | 9️⃣ 同模多物料同步 |
| MAT-008 | 高端手机壳 | 权重优先 | 3️⃣ 模具权重优先 |
| MAT-009 | 标准手机壳 | 权重优先 | 🔟 多模具灵活排程 |
| MAT-010 | 手机壳E | 一致性演示 | 6️⃣ 同物料一致性 |
| MAT-011 | 手机壳F | 一致性演示 | 6️⃣ 同物料一致性 |

### 设备配置 (6个)

| 设备代码 | 设备名称 | 产能 | 权重 | 用途 |
|---------|---------|------|------|------|
| DEV-001 | 注塑机1号 | 100 | 90 | 基础设备 |
| DEV-002 | 注塑机2号 | 150 | 95 | 权重最高 |
| DEV-003 | 注塑机3号 | 80 | 70 | 低权重 |
| DEV-004 | 注塑机4号 | 120 | 85 | 基础设备 |
| DEV-005 | 高速注塑机 | 200 | 100 | 权重最高 |
| DEV-006 | 标准注塑机 | 100 | 50 | 低权重 |

### 模具配置 (8个)

| 模具代码 | 模具名称 | 数量 | 权重 | 用途 |
|---------|---------|------|------|------|
| MOLD-001 | 模具A | 2 | 90 | 基础模具 |
| MOLD-002 | 模具B | 1 | 85 | 单副模具 |
| MOLD-003 | 模具C | 3 | 80 | 多副模具 |
| MOLD-004 | 模具D | 2 | 75 | 基础模具 |
| MOLD-005 | 通用手机壳模具 | 2 | 88 | 同模多物料 |
| MOLD-006 | 高精度模具 | 1 | 100 | 权重最高 |
| MOLD-007 | 标准模具 | 2 | 50 | 低权重 |
| MOLD-008 | 单副绑定模具 | 1 | 92 | 绑定演示 |

---

## 🎯 10种规则演示设计

### 1️⃣ 交期优先

**计划单**: PL-URGENT-001
- 物料: MAT-001 (手机壳A)
- 数量: 5000
- 交期: 2天后
- 设计: 紧急订单，交期最短

**预期结果**:
- 排程原因: 1️⃣ 交期优先
- 说明: 系统优先安排以满足紧急交期

---

### 2️⃣ 设备权重优先

**计划单**: PL-DEV-WEIGHT-001
- 物料: MAT-001 (手机壳A)
- 数量: 3000
- 可用设备: DEV-001(权重70), DEV-002(权重95), DEV-003(权重60)
- 设计: 多个可用设备，权重不同

**预期结果**:
- 排程原因: 2️⃣ 设备权重优先
- 选择设备: DEV-002 (权重最高)
- 说明: 系统选择权重最高的设备

---

### 3️⃣ 模具权重优先

**计划单**: PL-MOLD-WEIGHT-001
- 物料: MAT-008 (高端手机壳)
- 数量: 2000
- 可用模具: MOLD-006(权重100), MOLD-001(权重70)
- 设计: 多个可用模具，权重不同

**预期结果**:
- 排程原因: 3️⃣ 模具权重优先
- 选择模具: MOLD-006 (权重最高)
- 说明: 系统选择权重最高的模具

---

### 4️⃣ 模具-设备独占性

**计划单**: PL-EXCLUSIVE-001
- 物料: MAT-003 (充电器)
- 数量: 4000
- 模具: MOLD-002 (单副模具)
- 设计: 单副模具可能被占用

**预期结果**:
- 排程原因: 4️⃣ 模具-设备独占性
- 说明: 模具因时间冲突需要独占设备

---

### 5️⃣ 模具-设备绑定

**计划单1**: PL-BIND-001
- 物料: MAT-002 (手机壳B)
- 数量: 2500
- 模具: MOLD-008 (单副绑定模具)
- 设计: 第一个计划单使用单副模具

**计划单2**: PL-BIND-002
- 物料: MAT-002 (手机壳B)
- 数量: 1500
- 模具: MOLD-008 (同一单副模具)
- 设计: 第二个计划单使用同一单副模具

**预期结果**:
- PL-BIND-001: 排程原因: 8️⃣ 计划单唯一性
- PL-BIND-002: 排程原因: 5️⃣ 模具-设备绑定
- 说明: 第二个计划单必须绑定到第一个计划单的设备

---

### 6️⃣ 同物料一致性

**计划单1**: PL-MAT-CONSIST-001
- 物料: MAT-010 (手机壳E)
- 数量: 3500
- 设计: 第一个计划单

**计划单2**: PL-MAT-CONSIST-002
- 物料: MAT-010 (手机壳E)
- 数量: 2000
- 设计: 第二个计划单，相同物料

**预期结果**:
- PL-MAT-CONSIST-001: 排程原因: 2️⃣ 设备权重优先
- PL-MAT-CONSIST-002: 排程原因: 6️⃣ 同物料一致性
- 说明: 相同物料优先分配到同一设备和模具

---

### 7️⃣ 同模具一致性

**计划单1**: PL-MOLD-CONSIST-001
- 物料: MAT-001 (手机壳A)
- 数量: 4000
- 模具: MOLD-005 (通用模具)
- 设计: 第一个计划单

**计划单2**: PL-MOLD-CONSIST-002
- 物料: MAT-002 (手机壳B)
- 数量: 3000
- 模具: MOLD-005 (同一模具)
- 设计: 第二个计划单，使用同一模具

**预期结果**:
- PL-MOLD-CONSIST-001: 排程原因: 2️⃣ 设备权重优先
- PL-MOLD-CONSIST-002: 排程原因: 7️⃣ 同模具一致性
- 说明: 使用相同模具的计划单优先分配到同一设备

---

### 8️⃣ 计划单唯一性

**计划单**: PL-UNIQUE-001
- 物料: MAT-004 (电池盖板)
- 数量: 2500
- 设计: 标准计划单

**预期结果**:
- 排程原因: 8️⃣ 计划单唯一性
- 说明: 每个计划单完整分配到一台设备和一副模具

---

### 9️⃣ 同模多物料同步

**计划单1**: PL-MULTI-MAT-001
- 物料: MAT-006 (手机壳C)
- 数量: 3000
- 模具: MOLD-005 (通用模具)
- 交期: 4天后
- 设计: 第一个物料

**计划单2**: PL-MULTI-MAT-002
- 物料: MAT-007 (手机壳D)
- 数量: 2500
- 模具: MOLD-005 (同一模具)
- 交期: 4天后
- 设计: 第二个物料，相同模具和交期

**预期结果**:
- 两个计划单: 排程原因: 9️⃣ 同模多物料同步
- 说明: 使用同一模具生产多种物料需同步生产

---

### 🔟 多模具灵活排程

**计划单**: PL-FLEXIBLE-001
- 物料: MAT-009 (标准手机壳)
- 数量: 1500
- 可用设备: DEV-006(权重50), DEV-001(权重70)
- 可用模具: MOLD-007(权重50), MOLD-001(权重75)
- 交期: 3天后
- 设计: 灵活选择资源

**预期结果**:
- 排程原因: 🔟 多模具灵活排程
- 说明: 交期不足时可灵活选择其他设备和模具

---

## 📈 执行排程后的预期结果

### 排程原因分布

```
1️⃣ 交期优先: 1个任务单
2️⃣ 设备权重优先: 3-4个任务单
3️⃣ 模具权重优先: 1个任务单
4️⃣ 模具-设备独占性: 1个任务单
5️⃣ 模具-设备绑定: 1个任务单
6️⃣ 同物料一致性: 1个任务单
7️⃣ 同模具一致性: 1个任务单
8️⃣ 计划单唯一性: 1-2个任务单
9️⃣ 同模多物料同步: 2个任务单
🔟 多模具灵活排程: 1个任务单
```

### 总任务单数

预期: 14-15个任务单

---

## 🔍 验证清单

执行排程后，检查以下内容：

- [ ] 所有14个计划单都被排产
- [ ] 每个任务单都有排程原因
- [ ] 排程原因来自10条规则之一
- [ ] 紧急订单优先排程
- [ ] 权重高的设备/模具被优先选择
- [ ] 单副模具的绑定关系被正确处理
- [ ] 同物料的计划单分配到同一设备
- [ ] 同模具的计划单分配到同一设备
- [ ] 同模多物料的计划单同步排程

---

## 💡 学习建议

### 对于新用户

1. 运行初始化脚本
2. 执行排程
3. 查看排程结果
4. 对比每个规则的演示场景
5. 理解排程系统的工作原理

### 对于业务人员

1. 分析排程原因分布
2. 理解权重的影响
3. 调整权重值进行优化
4. 重新执行排程验证结果

### 对于系统管理员

1. 验证排程逻辑是否正确
2. 检查规则优先级是否合理
3. 调整规则参数
4. 支持用户的问题解答

---

## 🔧 自定义演示

### 修改权重值

编辑 `scripts/init-comprehensive-scheduling-data.js`，修改权重值：

```javascript
{ matCode: 'MAT-001', devCode: 'DEV-002', weight: 95 }, // 修改权重
```

### 添加新的演示场景

在 `createPlans()` 函数中添加新的计划单：

```javascript
{
  number: 'PL-CUSTOM-001',
  matCode: 'MAT-001',
  quantity: 5000,
  dueDate: new Date(now.getTime() + 5 * 24 * 60 * 60 * 1000),
  desc: '自定义演示场景'
}
```

### 重新初始化

```bash
# 清空现有数据（可选）
# 然后运行脚本
node scripts/init-comprehensive-scheduling-data.js
```

---

## 📞 故障排除

### 脚本执行失败

**原因**: 后端服务未运行

**解决**:
```bash
npm run dev
```

### 数据已存在

**原因**: 数据已经初始化过

**解决**: 脚本会自动跳过已存在的数据

### 排程结果不符合预期

**原因**: 排程引擎的规则检测逻辑

**解决**: 检查 `server/services/SchedulingEngine.js` 中的规则优先级

---

## 📚 相关文档

- `SCHEDULING_REASON_QUICK_REFERENCE.md` - 排程原因快速参考
- `dev_log/SCHEDULING_REASON_DISPLAY.md` - 排程原因显示功能
- `dev_log/SCHEDULING_REASON_ENHANCEMENT.md` - 排程原因增强说明

---

## 🎉 总结

✅ **综合演示数据已准备**
- 11个物料，6个设备，8个模具
- 14个计划单，覆盖10种排程规则
- 完整的关系配置

✅ **立即可用**
- 运行脚本初始化数据
- 执行排程查看结果
- 学习排程系统的工作原理

✅ **支持自定义**
- 可以修改权重值
- 可以添加新的演示场景
- 可以调整规则参数

---

**现在就运行脚本，体验完整的排程演示吧！** 🚀

```bash
node scripts/init-comprehensive-scheduling-data.js
```

