# 10种排程规则验证指南

**版本**: v1.0  
**创建时间**: 2025-12-26  
**目标**: 验证每种排程规则的演示结果

---

## 📋 概述

本指南帮助用户验证排程系统是否正确应用了10种核心排程规则。每个规则都有对应的计划单和预期的排程结果。

---

## 🚀 快速开始

### 步骤1: 初始化演示数据

```bash
node scripts/init-10-rules-demo-data.js
```

**输出**:
```
✨ 10种排程规则演示数据初始化完成！

📊 数据统计:
  • 物料: 11个
  • 设备: 6个
  • 模具: 8个
  • 计划单: 14个
```

### 步骤2: 执行排程

1. 打开浏览器访问 http://localhost:3000
2. 登录系统
3. 点击"辅助排程"
4. 点击"执行自动排产"按钮
5. 确认操作

### 步骤3: 查看排程结果

1. 点击"排程结果"标签页
2. 查看每个任务单的"排程原因"列
3. 对比下面的验证清单

---

## ✅ 10种规则验证清单

### 1️⃣ 交期优先

**计划单**: PL-URGENT-001
- 物料: 手机壳A (MAT-001)
- 数量: 5000
- 交期: 2天后（最紧急）

**预期排程原因**:
```
1️⃣ 交期优先 - 所有排程决策以满足交期为首要目标
```

**验证方法**:
- [ ] 查看排程结果中 PL-URGENT-001 对应的任务单
- [ ] 确认排程原因包含"1️⃣ 交期优先"
- [ ] 该任务单应该优先排程（在结果列表中靠前）

**说明**: 系统识别到交期最紧张（2天），因此优先安排该计划单。

---

### 2️⃣ 设备权重优先

**计划单**: PL-DEV-WEIGHT-001
- 物料: 手机壳A (MAT-001)
- 数量: 3000
- 可用设备: DEV-001(权重70), DEV-002(权重95), DEV-003(权重60)

**预期排程原因**:
```
2️⃣ 设备权重优先 - 权重高的设备优先选择
```

**预期分配设备**: DEV-002 (权重最高: 95)

**验证方法**:
- [ ] 查看排程结果中 PL-DEV-WEIGHT-001 对应的任务单
- [ ] 确认排程原因包含"2️⃣ 设备权重优先"
- [ ] 确认分配的设备是 DEV-002 (注塑机2号)

**说明**: 系统在多个可用设备中选择了权重最高的设备。

---

### 3️⃣ 模具权重优先

**计划单**: PL-MOLD-WEIGHT-001
- 物料: 高端手机壳 (MAT-008)
- 数量: 2000
- 可用模具: MOLD-006(权重100), MOLD-001(权重70)

**预期排程原因**:
```
3️⃣ 模具权重优先 - 权重高的模具优先选择
```

**预期分配模具**: MOLD-006 (权重最高: 100)

**验证方法**:
- [ ] 查看排程结果中 PL-MOLD-WEIGHT-001 对应的任务单
- [ ] 确认排程原因包含"3️⃣ 模具权重优先"
- [ ] 确认分配的模具是 MOLD-006 (高精度模具)

**说明**: 系统在多个可用模具中选择了权重最高的模具。

---

### 4️⃣ 模具-设备独占性

**计划单**: PL-EXCLUSIVE-001
- 物料: 充电器 (MAT-003)
- 数量: 4000
- 模具: MOLD-002 (单副模具)

**预期排程原因**:
```
4️⃣ 模具-设备独占性 - 同一模具同一时间只能分配到一台设备
```

**验证方法**:
- [ ] 查看排程结果中 PL-EXCLUSIVE-001 对应的任务单
- [ ] 确认排程原因包含"4️⃣ 模具-设备独占性"
- [ ] 确认分配的模具是 MOLD-002 (单副模具)

**说明**: 系统识别到该模具是单副模具，需要独占设备。

---

### 5️⃣ 模具-设备绑定

**计划单1**: PL-BIND-001
- 物料: 手机壳B (MAT-002)
- 数量: 2500
- 模具: MOLD-008 (单副绑定模具)

**计划单2**: PL-BIND-002
- 物料: 手机壳B (MAT-002)
- 数量: 1500
- 模具: MOLD-008 (同一单副模具)

**预期排程原因**:
```
PL-BIND-001: 8️⃣ 计划单唯一性 - 第一个计划单
PL-BIND-002: 5️⃣ 模具-设备绑定 - 第二个计划单必须绑定到第一个的设备
```

**验证方法**:
- [ ] 查看排程结果中 PL-BIND-001 对应的任务单
- [ ] 确认排程原因是"8️⃣ 计划单唯一性"
- [ ] 记录 PL-BIND-001 分配的设备 ID
- [ ] 查看排程结果中 PL-BIND-002 对应的任务单
- [ ] 确认排程原因包含"5️⃣ 模具-设备绑定"
- [ ] 确认 PL-BIND-002 分配的设备与 PL-BIND-001 相同

**说明**: 第一个计划单使用单副模具后，第二个计划单必须绑定到同一设备。

---

### 6️⃣ 同物料一致性

**计划单1**: PL-MAT-CONSIST-001
- 物料: 手机壳E (MAT-010)
- 数量: 3500

**计划单2**: PL-MAT-CONSIST-002
- 物料: 手机壳E (MAT-010)
- 数量: 2000

**预期排程原因**:
```
PL-MAT-CONSIST-001: 2️⃣ 设备权重优先 - 第一个计划单
PL-MAT-CONSIST-002: 6️⃣ 同物料一致性 - 第二个计划单
```

**验证方法**:
- [ ] 查看排程结果中 PL-MAT-CONSIST-001 对应的任务单
- [ ] 确认排程原因包含"2️⃣ 设备权重优先"
- [ ] 记录 PL-MAT-CONSIST-001 分配的设备和模具
- [ ] 查看排程结果中 PL-MAT-CONSIST-002 对应的任务单
- [ ] 确认排程原因包含"6️⃣ 同物料一致性"
- [ ] 确认 PL-MAT-CONSIST-002 分配的设备与 PL-MAT-CONSIST-001 相同

**说明**: 相同物料的计划单优先分配到同一设备和模具。

---

### 7️⃣ 同模具一致性

**计划单1**: PL-MOLD-CONSIST-001
- 物料: 手机壳A (MAT-001)
- 数量: 4000
- 模具: MOLD-001 (通用模具)

**计划单2**: PL-MOLD-CONSIST-002
- 物料: 手机壳B (MAT-002)
- 数量: 3000
- 模具: MOLD-001 (同一模具)

**预期排程原因**:
```
PL-MOLD-CONSIST-001: 2️⃣ 设备权重优先 - 第一个计划单
PL-MOLD-CONSIST-002: 7️⃣ 同模具一致性 - 第二个计划单
```

**验证方法**:
- [ ] 查看排程结果中 PL-MOLD-CONSIST-001 对应的任务单
- [ ] 确认排程原因包含"2️⃣ 设备权重优先"
- [ ] 记录 PL-MOLD-CONSIST-001 分配的设备
- [ ] 查看排程结果中 PL-MOLD-CONSIST-002 对应的任务单
- [ ] 确认排程原因包含"7️⃣ 同模具一致性"
- [ ] 确认 PL-MOLD-CONSIST-002 分配的设备与 PL-MOLD-CONSIST-001 相同

**说明**: 使用相同模具的计划单优先分配到同一设备。

---

### 8️⃣ 计划单唯一性

**计划单**: PL-UNIQUE-001
- 物料: 电池盖板 (MAT-004)
- 数量: 2500

**预期排程原因**:
```
8️⃣ 计划单唯一性 - 每个计划单完整分配到一台设备和一副模具
```

**验证方法**:
- [ ] 查看排程结果中 PL-UNIQUE-001 对应的任务单
- [ ] 确认排程原因包含"8️⃣ 计划单唯一性"
- [ ] 确认该任务单分配了一台设备和一副模具

**说明**: 这是默认的排程规则，当其他规则都不适用时使用。

---

### 9️⃣ 同模多物料同步

**计划单1**: PL-MULTI-MAT-001
- 物料: 手机壳C (MAT-006)
- 数量: 3000
- 模具: MOLD-005 (通用模具)
- 交期: 4天后

**计划单2**: PL-MULTI-MAT-002
- 物料: 手机壳D (MAT-007)
- 数量: 2500
- 模具: MOLD-005 (同一模具)
- 交期: 4天后

**预期排程原因**:
```
PL-MULTI-MAT-001: 9️⃣ 同模多物料同步
PL-MULTI-MAT-002: 9️⃣ 同模多物料同步
```

**验证方法**:
- [ ] 查看排程结果中 PL-MULTI-MAT-001 对应的任务单
- [ ] 确认排程原因包含"9️⃣ 同模多物料同步"
- [ ] 记录 PL-MULTI-MAT-001 分配的设备、模具和时间
- [ ] 查看排程结果中 PL-MULTI-MAT-002 对应的任务单
- [ ] 确认排程原因包含"9️⃣ 同模多物料同步"
- [ ] 确认 PL-MULTI-MAT-002 分配的设备、模具和时间与 PL-MULTI-MAT-001 相同

**说明**: 使用同一模具生产多种物料需要同步生产，分配相同的设备和时间。

---

### 🔟 多模具灵活排程

**计划单**: PL-FLEXIBLE-001
- 物料: 标准手机壳 (MAT-009)
- 数量: 1500
- 可用设备: DEV-006(权重50), DEV-001(权重70)
- 可用模具: MOLD-007(权重50), MOLD-001(权重75)
- 交期: 3天后

**预期排程原因**:
```
🔟 多模具灵活排程 - 交期不足时可灵活选择其他设备和模具
```

**验证方法**:
- [ ] 查看排程结果中 PL-FLEXIBLE-001 对应的任务单
- [ ] 确认排程原因包含"🔟 多模具灵活排程"
- [ ] 确认分配的设备和模具是可用选项之一

**说明**: 系统在交期紧张的情况下灵活选择可用的设备和模具。

---

## 📊 完整验证结果示例

执行排程后，排程结果应该如下所示：

| 任务单号 | 计划单号 | 物料 | 设备 | 模具 | 排程原因 |
|---------|---------|------|------|------|--------|
| TASK-xxx-001 | PL-URGENT-001 | 手机壳A | DEV-002 | MOLD-001 | 1️⃣ 交期优先 |
| TASK-xxx-002 | PL-DEV-WEIGHT-001 | 手机壳A | DEV-002 | MOLD-003 | 2️⃣ 设备权重优先 |
| TASK-xxx-003 | PL-MOLD-WEIGHT-001 | 高端手机壳 | DEV-002 | MOLD-006 | 3️⃣ 模具权重优先 |
| TASK-xxx-004 | PL-EXCLUSIVE-001 | 充电器 | DEV-004 | MOLD-002 | 4️⃣ 模具-设备独占性 |
| TASK-xxx-005 | PL-BIND-001 | 手机壳B | DEV-001 | MOLD-008 | 8️⃣ 计划单唯一性 |
| TASK-xxx-006 | PL-BIND-002 | 手机壳B | DEV-001 | MOLD-008 | 5️⃣ 模具-设备绑定 |
| TASK-xxx-007 | PL-MAT-CONSIST-001 | 手机壳E | DEV-002 | MOLD-001 | 2️⃣ 设备权重优先 |
| TASK-xxx-008 | PL-MAT-CONSIST-002 | 手机壳E | DEV-002 | MOLD-001 | 6️⃣ 同物料一致性 |
| TASK-xxx-009 | PL-MOLD-CONSIST-001 | 手机壳A | DEV-001 | MOLD-001 | 2️⃣ 设备权重优先 |
| TASK-xxx-010 | PL-MOLD-CONSIST-002 | 手机壳B | DEV-001 | MOLD-001 | 7️⃣ 同模具一致性 |
| TASK-xxx-011 | PL-UNIQUE-001 | 电池盖板 | DEV-003 | MOLD-004 | 8️⃣ 计划单唯一性 |
| TASK-xxx-012 | PL-MULTI-MAT-001 | 手机壳C | DEV-005 | MOLD-005 | 9️⃣ 同模多物料同步 |
| TASK-xxx-013 | PL-MULTI-MAT-002 | 手机壳D | DEV-005 | MOLD-005 | 9️⃣ 同模多物料同步 |
| TASK-xxx-014 | PL-FLEXIBLE-001 | 标准手机壳 | DEV-001 | MOLD-001 | 🔟 多模具灵活排程 |

---

## 🔍 故障排除

### 问题1: 所有任务都显示"8️⃣ 计划单唯一性"

**原因**: 排程引擎的规则检测逻辑未正确执行

**解决方案**:
1. 检查 `server/services/SchedulingEngine.js` 中的 `determineSchedulingReason()` 方法
2. 确保规则检测的条件正确
3. 重新启动后端服务
4. 重新执行排程

### 问题2: 排程结果不符合预期

**原因**: 可能是数据初始化不完整或排程逻辑有问题

**解决方案**:
1. 运行重置脚本清空数据
2. 重新运行初始化脚本
3. 检查数据库中的关系配置是否正确
4. 查看后端日志了解排程过程

### 问题3: 某些计划单未被排产

**原因**: 可能是该计划单没有可用的设备或模具

**解决方案**:
1. 检查该计划单的物料是否有设备-模具关系配置
2. 确保相关设备和模具的状态为"normal"
3. 查看后端日志中的警告信息

---

## 💡 学习建议

### 对于新用户

1. 按顺序验证每个规则
2. 理解每个规则的应用场景
3. 观察排程系统如何做出决策
4. 对比不同规则的排程结果

### 对于业务人员

1. 分析排程原因分布
2. 理解权重对排程的影响
3. 调整权重值进行优化
4. 重新执行排程验证结果

### 对于系统管理员

1. 验证排程逻辑是否正确
2. 检查规则优先级是否合理
3. 调整规则参数
4. 支持用户的问题解答

---

## 📚 相关文档

- `COMPREHENSIVE_DEMO_GUIDE.md` - 综合演示数据指南
- `SCHEDULING_REASON_QUICK_REFERENCE.md` - 排程原因快速参考
- `server/services/SchedulingEngine.js` - 排程引擎源代码

---

## 🎉 总结

✅ **演示数据已准备**
- 14个计划单，覆盖10种排程规则
- 每个规则都有对应的验证方法
- 完整的预期结果示例

✅ **验证流程清晰**
- 按步骤初始化数据
- 执行排程
- 对比验证清单

✅ **支持学习和优化**
- 理解排程系统的工作原理
- 调整参数进行优化
- 支持业务决策

---

**现在就开始验证吧！** 🚀

```bash
# 1. 初始化演示数据
node scripts/init-10-rules-demo-data.js

# 2. 访问系统执行排程
# http://localhost:3000 -> 辅助排程 -> 执行自动排产

# 3. 查看排程结果
# 点击"排程结果"标签页，对比验证清单
```
